<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tasks/virtualenv.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tasks/virtualenv.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { asyncExec } from 'async-shelljs';
import { getOS } from '../common/common';

const target = {};
let targetDir;

/**
 * Using virtualenv to freeze and install correct pip packages
 * @param {Object} options 
 */
async function pipInstallAndFreeze(options) {
  try {
    const devNul = await getDevNul();
    await asyncExec(`virtualenv ${targetDir}${target.osVar}`);
    await asyncExec(`${targetDir}${target.pip} install -r ${options.backendDir}${target.requirements} > ${devNul}`);
    await asyncExec(`${targetDir}${target.pip} freeze --local >> ${options.backendDir}${target.requirements} > ${devNul}`);
  } catch (err) {
    throw err;
  }
}

// TODO: Check if python3 is installed
/**
 * Installing and using virtualenv
 * @param {Object} options 
 */
export async function installVirtualEnv(options) {
  targetDir = options.targetDirectory;
  try {
    const usrOS = await getOS();
    await targetOS(options, usrOS);
    if (!options.gitpod &amp;&amp; usrOS === 'windows') {
      await asyncExec('pip install virtualenv');
      await pipInstallAndFreeze(options);
    } else {
      await asyncExec('pip3 install virtualenv > /dev/null 2>&amp;1');
      await pipInstallAndFreeze(options);
    }
    options.env = true;
  } catch (err) {
  }
}

/**
 * Install Flask into the virtual environment
 */
export async function flaskApp() {
  const devNul = await getDevNul();
  await asyncExec(`${targetDir}${target.pip} install Flask > ${devNul}`);
  return;
}

/**
 * Installs Django into the virtual environment
 */
export async function djangoApp() {
  const devNul = await getDevNul();
  await asyncExec(`${targetDir}${target.pip} install Django > ${devNul}`);
  return;
}

/**
 * Checks if we want to use dev/null or Nul
 * @returns {Promise&lt;String>} Nul or dev/null
 */
async function getDevNul() {
  return (await getOS()) === 'windows' ? 'NUL' : '/dev/null 2>&amp;1';
}

/**
 * Sets up the correct targets for use depending on OS
 * @param {Object} options 
 * @param {String} platform 
 */
async function targetOS(options, platform) {
  let envName = !options.envName ? 'env' : options.envName;
  if (platform == 'windows') {
    //prettier-ignore
    target.path = `\\\\${envName}\\Scripts\\activate`;
    target.osVar = `\\\\${envName}`;
    target.pythonExecutable = `\\\\${envName}\\Scripts\\python.exe`;
    target.pip = `\\\\${envName}\\Scripts\\pip.exe`;
    target.requirements = '\\requirements.txt';
  } else {
    target.path = `/${envName}/bin/activate`;
    target.osVar = `/${envName}`;
    target.pythonExecutable = `/${envName}/bin/python3`;
    target.pip = `/${envName}/bin/pip3`;
    target.requirements = '/requirements.txt';
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkCopyType">checkCopyType</a></li><li><a href="global.html#cli">cli</a></li><li><a href="global.html#copyFiles">copyFiles</a></li><li><a href="global.html#createENVPy">createENVPy</a></li><li><a href="global.html#createGitIgnore">createGitIgnore</a></li><li><a href="global.html#createHTML">createHTML</a></li><li><a href="global.html#createMarkdown">createMarkdown</a></li><li><a href="global.html#createProcfile">createProcfile</a></li><li><a href="global.html#createProject">createProject</a></li><li><a href="global.html#createProjectDir">createProjectDir</a></li><li><a href="global.html#createVSCodeSettings">createVSCodeSettings</a></li><li><a href="global.html#djangoApp">djangoApp</a></li><li><a href="global.html#djangoOnly">djangoOnly</a></li><li><a href="global.html#djangoSettings">djangoSettings</a></li><li><a href="global.html#doesEnvExistForProject">doesEnvExistForProject</a></li><li><a href="global.html#envQuestions">envQuestions</a></li><li><a href="global.html#flaskApp">flaskApp</a></li><li><a href="global.html#flaskOnly">flaskOnly</a></li><li><a href="global.html#flaskSettings">flaskSettings</a></li><li><a href="global.html#generateENVFile">generateENVFile</a></li><li><a href="global.html#generateHTML">generateHTML</a></li><li><a href="global.html#generatePath">generatePath</a></li><li><a href="global.html#generatePythonSettings">generatePythonSettings</a></li><li><a href="global.html#generateREADME">generateREADME</a></li><li><a href="global.html#generateRequirements">generateRequirements</a></li><li><a href="global.html#generateTESTING">generateTESTING</a></li><li><a href="global.html#getDevNul">getDevNul</a></li><li><a href="global.html#getOS">getOS</a></li><li><a href="global.html#gitTasks">gitTasks</a></li><li><a href="global.html#installVirtualEnv">installVirtualEnv</a></li><li><a href="global.html#parseArgumentsIntoOptions">parseArgumentsIntoOptions</a></li><li><a href="global.html#pipInstallAndFreeze">pipInstallAndFreeze</a></li><li><a href="global.html#promptForMissingOptions">promptForMissingOptions</a></li><li><a href="global.html#targetOS">targetOS</a></li><li><a href="global.html#title">title</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sat May 09 2020 13:31:00 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
